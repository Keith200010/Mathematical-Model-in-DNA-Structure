<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNA结构中的数学模型（高精度可视化）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36B37E',
                        accent: '#FF5630',
                        dnaA: '#FF4757',    // A-T配对颜色
                        dnaT: '#FF4757',
                        dnaG: '#2ED573',    // G-C配对颜色
                        dnaC: '#2ED573',
                        dnaSugar: '#74B9FF',// 脱氧核糖颜色
                        dnaPhosphate: '#FD79A8'// 磷酸基团颜色
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-custom {
                transition: all 0.3s ease;
            }
            .dna-strand {
                transition: height 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .base-pair {
                transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
                transform-origin: center center;
            }
            .phosphate-group {
                border-radius: 50%;
                box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            }
            .sugar-group {
                border-radius: 4px;
                box-shadow: 0 1px 2px rgba(0,0,0,0.15);
            }
            .helix-container {
                perspective: 1000px;
                perspective-origin: center;
            }
            .helix-inner {
                transform-style: preserve-3d;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
    <!-- 导航栏 -->
    <nav id="navbar" class="fixed w-full bg-white/90 backdrop-blur-sm shadow-sm z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-dna text-primary text-2xl"></i>
                <span class="font-bold text-xl text-primary">DNA数学模型</span>
            </div>
            
            <!-- 桌面导航 -->
            <div class="hidden md:flex space-x-8">
                <a href="#intro" class="text-gray-600 hover:text-primary transition-custom">简介</a>
                <a href="#base-calculation" class="text-gray-600 hover:text-primary transition-custom">碱基占比计算</a>
                <a href="#length-relationship" class="text-gray-600 hover:text-primary transition-custom">长度与碱基对</a>
                <a href="#examples" class="text-gray-600 hover:text-primary transition-custom">示例与练习</a>
            </div>
            
            <!-- 移动端菜单按钮 -->
            <button id="menuBtn" class="md:hidden text-gray-600 focus:outline-none">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- 移动端导航菜单 -->
        <div id="mobileMenu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <a href="#intro" class="py-2 text-gray-600 hover:text-primary transition-custom">简介</a>
                <a href="#base-calculation" class="py-2 text-gray-600 hover:text-primary transition-custom">碱基占比计算</a>
                <a href="#length-relationship" class="py-2 text-gray-600 hover:text-primary transition-custom">长度与碱基对</a>
                <a href="#examples" class="py-2 text-gray-600 hover:text-primary transition-custom">示例与练习</a>
            </div>
        </div>
    </nav>

    <!-- 英雄区 -->
    <header class="pt-24 pb-16 md:pt-32 md:pb-24 bg-gradient-to-br from-primary/5 to-secondary/5">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto text-center">
                <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-dark mb-6 leading-tight text-shadow">
                    DNA结构中的数学模型
                </h1>
                <p class="text-lg md:text-xl text-gray-600 mb-8">
                    探索DNA分子中碱基配对的数学规律，以及碱基对数量与DNA长度之间的关系
                </p>
                <div class="flex flex-wrap justify-center gap-4">
                    <a href="#base-calculation" class="px-6 py-3 bg-primary text-white rounded-lg shadow-md hover:bg-primary/90 transition-custom">
                        碱基占比计算
                    </a>
                    <a href="#length-relationship" class="px-6 py-3 bg-white text-primary border border-primary rounded-lg shadow-sm hover:bg-gray-50 transition-custom">
                        DNA长度关系
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12">
        <!-- 简介部分 -->
        <section id="intro" class="max-w-4xl mx-auto mb-20 scroll-mt-24">
            <div class="bg-white rounded-xl shadow-md p-6 md:p-8">
                <h2 class="text-2xl md:text-3xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa fa-info-circle text-primary mr-3"></i>DNA结构简介
                </h2>
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <p class="text-gray-700 mb-4">
                            DNA（脱氧核糖核酸）是由两条互补的核苷酸链组成的双螺旋结构。每个核苷酸包含一个磷酸基团、一个脱氧核糖和一个含氮碱基。
                        </p>
                        <p class="text-gray-700 mb-4">
                            DNA中有四种碱基：腺嘌呤（A）、胸腺嘧啶（T）、鸟嘌呤（G）和胞嘧啶（C）。这些碱基遵循特定的配对规则：
                        </p>
                        <ul class="list-disc pl-5 text-gray-700 space-y-2">
                            <li>腺嘌呤（A）总是与胸腺嘧啶（T）配对</li>
                            <li>鸟嘌呤（G）总是与胞嘧啶（C）配对</li>
                        </ul>
                        <p class="text-gray-700 mt-4">
                            这些配对规则形成了DNA结构中的基本数学关系，使我们能够通过已知的碱基比例计算出其他碱基的比例，即使只知道一条链的碱基组成。
                        </p>
                    </div>
                    <div class="relative rounded-lg overflow-hidden shadow-lg">
                        <img src="https://picsum.photos/id/177/600/400" alt="DNA双螺旋结构示意图" class="w-full h-auto rounded-lg">
                        <div class="absolute bottom-0 left-0 right-0 bg-dark/70 text-white p-3 text-sm">
                            DNA双螺旋结构展示了碱基配对的规律
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 碱基占比计算部分 -->
        <section id="base-calculation" class="max-w-4xl mx-auto mb-20 scroll-mt-24">
            <div class="bg-white rounded-xl shadow-md p-6 md:p-8">
                <h2 class="text-2xl md:text-3xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa fa-calculator text-primary mr-3"></i>碱基占比计算
                </h2>
                
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800"> Chargaff规则与单链碱基计算</h3>
                    <p class="text-gray-700 mb-4">
                        即使只知道DNA一条链的碱基组成，也能通过碱基互补配对原则计算出整个DNA分子的碱基比例：
                    </p>
                    <ol class="list-decimal pl-5 text-gray-700 space-y-2 mb-4">
                        <li>一条链上的A与另一条链上的T数量相等（A₁ = T₂，A₂ = T₁）</li>
                        <li>一条链上的G与另一条链上的C数量相等（G₁ = C₂，G₂ = C₁）</li>
                        <li>整个DNA分子中A总 = T总，G总 = C总</li>
                        <li>总碱基比例 = (链1比例 + 链2比例) ÷ 2</li>
                    </ol>
                    
                    <div class="bg-neutral p-4 rounded-md my-4">
                        <p class="font-medium mb-2">计算公式：</p>
                        <div class="grid md:grid-cols-2 gap-2 text-sm">
                            <div>A<sub>总</sub> = (A₁ + T₁) ÷ 2</div>
                            <div>T<sub>总</sub> = A<sub>总</sub></div>
                            <div>G<sub>总</sub> = (G₁ + C₁) ÷ 2</div>
                            <div>C<sub>总</sub> = G<sub>总</sub></div>
                        </div>
                    </div>
                </div>
                
                <!-- 计算类型选择器 -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">计算类型：</label>
                    <div class="flex flex-wrap gap-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="calculationType" value="double" checked 
                                class="w-4 h-4 text-primary focus:ring-primary border-gray-300">
                            <span class="ml-2 text-gray-700">已知双链部分碱基比例</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="calculationType" value="single" 
                                class="w-4 h-4 text-primary focus:ring-primary border-gray-300">
                            <span class="ml-2 text-gray-700">已知一条链的碱基比例</span>
                        </label>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- 碱基计算器 -->
                    <div class="bg-neutral rounded-lg p-6 shadow-sm">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800" id="calculatorTitle">碱基比例计算器</h3>
                        <p class="text-gray-600 mb-4 text-sm" id="calculatorDescription">
                            输入已知的碱基比例（百分比），计算其他碱基的比例：
                        </p>
                        
                        <!-- 双链计算输入区 -->
                        <div id="doubleStrandInputs" class="space-y-4">
                            <div>
                                <label for="adenine" class="block text-sm font-medium text-gray-700 mb-1">腺嘌呤 (A)：</label>
                                <input type="number" id="adenine" min="0" max="100" step="0.1" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            
                            <div>
                                <label for="thymine" class="block text-sm font-medium text-gray-700 mb-1">胸腺嘧啶 (T)：</label>
                                <input type="number" id="thymine" min="0" max="100" step="0.1" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            
                            <div>
                                <label for="guanine" class="block text-sm font-medium text-gray-700 mb-1">鸟嘌呤 (G)：</label>
                                <input type="number" id="guanine" min="0" max="100" step="0.1" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            
                            <div>
                                <label for="cytosine" class="block text-sm font-medium text-gray-700 mb-1">胞嘧啶 (C)：</label>
                                <input type="number" id="cytosine" min="0" max="100" step="0.1" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                        </div>
                        
                        <!-- 单链计算输入区 (默认隐藏) -->
                        <div id="singleStrandInputs" class="space-y-4 hidden">
                            <div>
                                <label for="a1" class="block text-sm font-medium text-gray-700 mb-1">链1的腺嘌呤 (A₁)：</label>
                                <input type="number" id="a1" min="0" max="100" step="0.1" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            
                            <div>
                                <label for="t1" class="block text-sm font-medium text-gray-700 mb-1">链1的胸腺嘧啶 (T₁)：</label>
                                <input type="number" id="t1" min="0" max="100" step="0.1" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            
                            <div>
                                <label for="g1" class="block text-sm font-medium text-gray-700 mb-1">链1的鸟嘌呤 (G₁)：</label>
                                <input type="number" id="g1" min="0" max="100" step="0.1" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            
                            <div>
                                <label for="c1" class="block text-sm font-medium text-gray-700 mb-1">链1的胞嘧啶 (C₁)：</label>
                                <input type="number" id="c1" min="0" max="100" step="0.1" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                        </div>
                        
                        <div class="space-y-3 mt-4">
                            <button id="calculateBases" class="w-full py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-custom">
                                计算碱基比例
                            </button>
                            
                            <button id="resetBases" class="w-full py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-custom">
                                重置
                            </button>
                        </div>
                        
                        <div id="baseResult" class="mt-4 hidden p-3 rounded-md bg-gray-50 border border-gray-200">
                            <p class="text-sm text-gray-700" id="baseResultText"></p>
                        </div>
                    </div>
                    
                    <!-- 碱基比例图表 -->
                    <div class="bg-neutral rounded-lg p-6 shadow-sm">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">碱基比例可视化</h3>
                        <p class="text-gray-600 mb-4 text-sm">计算结果的图表展示：</p>
                        <div class="aspect-square max-w-xs mx-auto">
                            <canvas id="baseChart"></canvas>
                        </div>
                        
                        <!-- 单链结果展示区 (默认隐藏) -->
                        <div id="singleStrandResults" class="mt-6 hidden">
                            <h4 class="font-medium text-gray-800 mb-2">互补链与总比例：</h4>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="bg-white p-2 rounded border border-gray-200">
                                    <p class="text-gray-500">链2的A₂</p>
                                    <p class="font-medium" id="a2Result">-</p>
                                </div>
                                <div class="bg-white p-2 rounded border border-gray-200">
                                    <p class="text-gray-500">链2的T₂</p>
                                    <p class="font-medium" id="t2Result">-</p>
                                </div>
                                <div class="bg-white p-2 rounded border border-gray-200">
                                    <p class="text-gray-500">链2的G₂</p>
                                    <p class="font-medium" id="g2Result">-</p>
                                </div>
                                <div class="bg-white p-2 rounded border border-gray-200">
                                    <p class="text-gray-500">链2的C₂</p>
                                    <p class="font-medium" id="c2Result">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- DNA长度与碱基对数量关系 -->
        <section id="length-relationship" class="max-w-4xl mx-auto mb-20 scroll-mt-24">
            <div class="bg-white rounded-xl shadow-md p-6 md:p-8">
                <h2 class="text-2xl md:text-3xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa fa-arrows-h text-primary mr-3"></i>DNA长度与碱基对数量的关系
                </h2>
                
                <div class="mb-8">
                    <p class="text-gray-700 mb-4">
                        DNA分子的长度与其包含的碱基对（bp）数量直接相关。不同形式的DNA具有不同的结构参数：
                    </p>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="py-3 px-4 border border-gray-200 text-left text-sm font-semibold text-gray-700">DNA类型</th>
                                    <th class="py-3 px-4 border border-gray-200 text-left text-sm font-semibold text-gray-700">每圈碱基对数量</th>
                                    <th class="py-3 px-4 border border-gray-200 text-left text-sm font-semibold text-gray-700">每碱基对长度</th>
                                    <th class="py-3 px-4 border border-gray-200 text-left text-sm font-semibold text-gray-700">每圈螺旋长度</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">B-DNA（最常见）</td>
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">约10.5 bp</td>
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">0.34 nm</td>
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">3.4 nm</td>
                                </tr>
                                <tr class="bg-gray-50">
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">A-DNA</td>
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">约11 bp</td>
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">0.26 nm</td>
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">2.8 nm</td>
                                </tr>
                                <tr>
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">Z-DNA</td>
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">约12 bp</td>
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">0.37 nm</td>
                                    <td class="py-3 px-4 border border-gray-200 text-sm text-gray-700">4.5 nm</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <p class="text-gray-700 mt-4">
                        对于最常见的B-DNA，我们可以使用以下公式计算其长度：
                    </p>
                    <div class="bg-neutral p-4 rounded-md my-3 text-center">
                        <p class="text-lg font-medium">DNA长度 (nm) = 碱基对数量 × 0.34 nm</p>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- DNA长度计算器 -->
                    <div class="bg-neutral rounded-lg p-6 shadow-sm">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">DNA长度计算器</h3>
                        <p class="text-gray-600 mb-4 text-sm">输入碱基对数量，计算DNA的长度：</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="basePairs" class="block text-sm font-medium text-gray-700 mb-1">碱基对数量 (bp)：</label>
                                <input type="number" id="basePairs" min="1" step="1" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            </div>
                            
                            <div>
                                <label for="dnaType" class="block text-sm font-medium text-gray-700 mb-1">DNA类型：</label>
                                <select id="dnaType" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                                    <option value="B">B-DNA（最常见）</option>
                                    <option value="A">A-DNA</option>
                                    <option value="Z">Z-DNA</option>
                                </select>
                            </div>
                            
                            <button id="calculateLength" class="w-full py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-custom">
                                计算DNA长度
                            </button>
                            
                            <button id="resetLength" class="w-full py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-custom">
                                重置
                            </button>
                        </div>
                        
                        <div id="lengthResult" class="mt-4 hidden p-3 rounded-md bg-gray-50 border border-gray-200">
                            <p class="text-sm text-gray-700" id="lengthResultText"></p>
                        </div>
                    </div>
                    
                    <!-- DNA长度可视化模型（高精度） -->
                    <div class="bg-neutral rounded-lg p-6 shadow-sm">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">DNA双螺旋结构模型</h3>
                        <p class="text-gray-600 mb-4 text-sm">根据计算结果生成的高精度DNA结构模型：</p>
                        
                        <!-- 3D立体DNA模型容器 -->
                        <div class="helix-container flex justify-center">
                            <div class="helix-inner relative w-44 h-64 border border-gray-300 rounded-lg bg-gradient-to-b from-blue-50 to-white shadow-lg overflow-hidden perspective-500">
                                <!-- 左侧链容器 -->
                                <div id="leftStrandContainer" class="absolute left-11">
                                    <div id="leftStrand" class="dna-strand relative w-2 bg-gradient-to-b from-blue-800 to-blue-600 rounded-full shadow-md"></div>
                                </div>
                                
                                <!-- 右侧链容器 -->
                                <div id="rightStrandContainer" class="absolute right-11">
                                    <div id="rightStrand" class="dna-strand relative w-2 bg-gradient-to-b from-blue-800 to-blue-600 rounded-full shadow-md"></div>
                                </div>
                                
                                <!-- 碱基对容器 -->
                                <div id="basePairsContainer" class="absolute left-0 right-0 transform-gpu"></div>
                                
                                <!-- 长度标尺 -->
                                <div class="length-scale absolute right-2 top-0 bottom-0 w-6 flex flex-col justify-between items-center">
                                    <div class="h-0.5 w-full bg-gray-300"></div>
                                    <div class="h-0.5 w-full bg-gray-300"></div>
                                    <div class="h-0.5 w-full bg-gray-300"></div>
                                    <div class="h-0.5 w-full bg-gray-300"></div>
                                    <div class="h-0.5 w-full bg-gray-300"></div>
                                    <div class="h-0.5 w-full bg-gray-300"></div>
                                    <div class="h-0.5 w-full bg-gray-300"></div>
                                </div>
                                
                                <!-- 3D效果装饰 -->
                                <div class="absolute inset-0 bg-gradient-to-tr from-transparent to-white/20 pointer-events-none"></div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <p id="visualizationLabel" class="text-sm text-gray-500">默认DNA模型展示（500 bp B-DNA）</p>
                        </div>
                        
                        <div class="mt-8 grid grid-cols-3 gap-2 w-full text-center text-xs text-gray-500">
                            <div>0 nm</div>
                            <div>中间点</div>
                            <div id="maxLengthLabel">10000 nm</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 示例与练习 -->
        <section id="examples" class="max-w-4xl mx-auto mb-12 scroll-mt-24">
            <div class="bg-white rounded-xl shadow-md p-6 md:p-8">
                <h2 class="text-2xl md:text-3xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa fa-graduation-cap text-primary mr-3"></i>示例与练习
                </h2>
                
                <div class="space-y-8">
                    <!-- 示例 -->
                    <div>
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">示例</h3>
                        
                        <div class="bg-neutral p-5 rounded-lg mb-4">
                            <p class="font-medium mb-2">示例1：双链碱基比例计算</p>
                            <p class="text-gray-700 mb-2">如果一段DNA中腺嘌呤（A）的比例为22%，其他碱基的比例是多少？</p>
                            <p class="text-gray-700 font-medium">解答：</p>
                            <ul class="list-disc pl-5 text-gray-700 space-y-1">
                                <li>根据Chargaff规则，A = T，所以胸腺嘧啶（T）的比例也是22%</li>
                                <li>剩余的碱基比例为100% - 22% - 22% = 56%</li>
                                <li>这部分由G和C平分，所以鸟嘌呤（G）和胞嘧啶（C）各占28%</li>
                                <li>最终比例：A=22%，T=22%，G=28%，C=28%</li>
                            </ul>
                        </div>
                        
                        <div class="bg-neutral p-5 rounded-lg mb-4">
                            <p class="font-medium mb-2">示例2：单链碱基计算总比例</p>
                            <p class="text-gray-700 mb-2">已知DNA一条链的碱基比例为：A₁=15%，T₁=25%，G₁=30%，C₁=30%。计算整个DNA分子的碱基比例。</p>
                            <p class="text-gray-700 font-medium">解答：</p>
                            <ul class="list-disc pl-5 text-gray-700 space-y-1">
                                <li>互补链的碱基比例：A₂=T₁=25%，T₂=A₁=15%，G₂=C₁=30%，C₂=G₁=30%</li>
                                <li>总A比例 = (A₁ + A₂) ÷ 2 = (15% + 25%) ÷ 2 = 20%</li>
                                <li>总T比例 = 总A比例 = 20%</li>
                                <li>总G比例 = (G₁ + G₂) ÷ 2 = (30% + 30%) ÷ 2 = 30%</li>
                                <li>总C比例 = 总G比例 = 30%</li>
                                <li>最终总比例：A=20%，T=20%，G=30%，C=30%</li>
                            </ul>
                        </div>
                        
                        <div class="bg-neutral p-5 rounded-lg">
                            <p class="font-medium mb-2">示例3：DNA长度计算</p>
                            <p class="text-gray-700 mb-2">一段B-DNA包含5000个碱基对，它的长度是多少？</p>
                            <p class="text-gray-700 font-medium">解答：</p>
                            <ul class="list-disc pl-5 text-gray-700 space-y-1">
                                <li>B-DNA中每个碱基对的长度为0.34 nm</li>
                                <li>总长度 = 5000 × 0.34 nm = 1700 nm</li>
                                <li>转换为微米：1700 nm = 1.7 μm（1 μm = 1000 nm）</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- 练习题 -->
                    <div>
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">练习题</h3>
                        
                        <div class="space-y-4">
                            <div class="border border-gray-200 rounded-lg p-4">
                                <p class="font-medium mb-2">问题1</p>
                                <p class="text-gray-700 mb-2">如果一段DNA中鸟嘌呤（G）的比例为18%，请计算其他三种碱基的比例。</p>
                                <button class="showAnswer text-primary text-sm hover:underline" data-answer="根据Chargaff规则，G = C，所以胞嘧啶（C）的比例也是18%。剩余的碱基比例为100% - 18% - 18% = 64%，这部分由A和T平分，所以腺嘌呤（A）和胸腺嘧啶（T）各占32%。最终比例：A=32%，T=32%，G=18%，C=18%。">
                                    显示答案
                                </button>
                                <p class="answer hidden mt-2 text-gray-700 text-sm pl-2 border-l-2 border-primary"></p>
                            </div>
                            
                            <div class="border border-gray-200 rounded-lg p-4">
                                <p class="font-medium mb-2">问题2</p>
                                <p class="text-gray-700 mb-2">已知DNA一条链的碱基比例为：A₁=20%，T₁=15%，G₁=25%，C₁=40%。计算整个DNA分子中各碱基的总比例。</p>
                                <button class="showAnswer text-primary text-sm hover:underline" data-answer="互补链比例：A₂=T₁=15%，T₂=A₁=20%，G₂=C₁=40%，C₂=G₁=25%。总A=(20%+15%)÷2=17.5%，总T=17.5%；总G=(25%+40%)÷2=32.5%，总C=32.5%。最终比例：A=17.5%，T=17.5%，G=32.5%，C=32.5%。">
                                    显示答案
                                </button>
                                <p class="answer hidden mt-2 text-gray-700 text-sm pl-2 border-l-2 border-primary"></p>
                            </div>
                            
                            <div class="border border-gray-200 rounded-lg p-4">
                                <p class="font-medium mb-2">问题3</p>
                                <p class="text-gray-700 mb-2">一段Z-DNA的长度为90 nm，它包含多少个碱基对？</p>
                                <button class="showAnswer text-primary text-sm hover:underline" data-answer="Z-DNA中每个碱基对的长度为0.37 nm，所以碱基对数量 = 90 nm ÷ 0.37 nm ≈ 243个碱基对。">
                                    显示答案
                                </button>
                                <p class="answer hidden mt-2 text-gray-700 text-sm pl-2 border-l-2 border-primary"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-gray-200 py-10">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md p-6 md:p-8">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8">
                    <div class="flex items-center mb-4 md:mb-0">
                        <i class="fa fa-dna text-primary text-2xl mr-2"></i>
                        <span class="font-bold text-xl text-primary">DNA数学模型</span>
                    </div>
                    <div class="flex space-x-6">
                        <a href="#" class="text-gray-600 hover:text-primary transition-custom">
                            <i class="fa fa-book mr-1"></i> 参考资料
                        </a>
                        <a href="#" class="text-gray-600 hover:text-primary transition-custom">
                            <i class="fa fa-question-circle mr-1"></i> 帮助
                        </a>
                        <a href="#" class="text-gray-600 hover:text-primary transition-custom">
                            <i class="fa fa-envelope mr-1"></i> 联系我们
                        </a>
                    </div>
                </div>
                
                <div class="border-t border-gray-200 pt-6 text-center text-gray-600 text-sm">
                    <p>© 2024 DNA数学模型教学页面 | 用于教育教学</p>
                    <p class="mt-2">本页面提供的信息仅用于教育目的，如需专业生物学知识，请参考权威教材和文献</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // 导航栏滚动效果
        window.addEventListener('scroll', function() {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('py-2', 'shadow');
                navbar.classList.remove('py-3');
            } else {
                navbar.classList.add('py-3');
                navbar.classList.remove('py-2', 'shadow');
            }
        });
        
        // 移动端菜单切换
        document.getElementById('menuBtn').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        });
        
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.getElementById('mobileMenu').classList.add('hidden');
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
        
        // 计算类型切换（双链/单链）
        const calculationTypeRadios = document.querySelectorAll('input[name="calculationType"]');
        const doubleStrandInputs = document.getElementById('doubleStrandInputs');
        const singleStrandInputs = document.getElementById('singleStrandInputs');
        const calculatorTitle = document.getElementById('calculatorTitle');
        const calculatorDescription = document.getElementById('calculatorDescription');
        const singleStrandResults = document.getElementById('singleStrandResults');
        
        calculationTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'double') {
                    doubleStrandInputs.classList.remove('hidden');
                    singleStrandInputs.classList.add('hidden');
                    singleStrandResults.classList.add('hidden');
                    calculatorTitle.textContent = '碱基比例计算器';
                    calculatorDescription.textContent = '输入已知的碱基比例（百分比），计算其他碱基的比例：';
                } else {
                    doubleStrandInputs.classList.add('hidden');
                    singleStrandInputs.classList.remove('hidden');
                    singleStrandResults.classList.remove('hidden');
                    calculatorTitle.textContent = '单链碱基计算总比例';
                    calculatorDescription.textContent = '输入一条链的碱基比例（百分比），计算总碱基比例：';
                }
                resetBases(); // 切换时重置
            });
        });
        
        // 碱基计算
        let baseChart;
        
        function initBaseChart() {
            const ctx = document.getElementById('baseChart').getContext('2d');
            baseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['腺嘌呤 (A)', '胸腺嘧啶 (T)', '鸟嘌呤 (G)', '胞嘧啶 (C)'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            '#FF4757', // 红色 - A
                            '#FF9F43', // 橙色 - T
                            '#2ED573', // 绿色 - G
                            '#5352ED'  // 蓝色 - C
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function updateBaseChart(a, t, g, c) {
            baseChart.data.datasets[0].data = [a, t, g, c];
            baseChart.update();
        }
        
        document.getElementById('calculateBases').addEventListener('click', function() {
            const calculationType = document.querySelector('input[name="calculationType"]:checked').value;
            let a, t, g, c;
            let valid = true;
            let message = '';
            
            if (calculationType === 'double') {
                // 双链计算逻辑
                const aInput = parseFloat(document.getElementById('adenine').value) || 0;
                const tInput = parseFloat(document.getElementById('thymine').value) || 0;
                const gInput = parseFloat(document.getElementById('guanine').value) || 0;
                const cInput = parseFloat(document.getElementById('cytosine').value) || 0;
                
                // 检查输入的有效性
                const nonZeroInputs = [
                    {name: 'A', value: aInput},
                    {name: 'T', value: tInput},
                    {name: 'G', value: gInput},
                    {name: 'C', value: cInput}
                ].filter(item => item.value > 0);
                
                if (nonZeroInputs.length > 2) {
                    valid = false;
                    message = '错误：最多只能输入两个碱基的比例（A和T配对，G和C配对）';
                } else if (nonZeroInputs.length === 2) {
                    // 检查是否是正确的配对组合
                    if (!((nonZeroInputs[0].name === 'A' && nonZeroInputs[1].name === 'T') || 
                         (nonZeroInputs[0].name === 'T' && nonZeroInputs[1].name === 'A') ||
                         (nonZeroInputs[0].name === 'G' && nonZeroInputs[1].name === 'C') ||
                         (nonZeroInputs[0].name === 'C' && nonZeroInputs[1].name === 'G'))) {
                        valid = false;
                        message = '错误：输入的碱基必须是配对的（A与T，G与C）';
                    }
                }
                
                if (valid) {
                    // 应用Chargaff规则计算
                    if (aInput > 0) {
                        a = aInput;
                        t = a; // A = T
                    } else if (tInput > 0) {
                        t = tInput;
                        a = t; // T = A
                    } else {
                        a = 0;
                        t = 0;
                    }
                    
                    if (gInput > 0) {
                        g = gInput;
                        c = g; // G = C
                    } else if (cInput > 0) {
                        c = cInput;
                        g = c; // C = G
                    } else {
                        g = 0;
                        c = 0;
                    }
                    
                    // 如果只输入了一对中的一个，计算另一对
                    if (nonZeroInputs.length === 1) {
                        const total = a + t + g + c;
                        if (total > 100) {
                            valid = false;
                            message = '错误：碱基比例总和不能超过100%';
                        } else {
                            const remaining = 100 - total;
                            if (a > 0 || t > 0) {
                                // 已输入A或T，计算G和C
                                g = remaining / 2;
                                c = remaining / 2;
                            } else if (g > 0 || c > 0) {
                                // 已输入G或C，计算A和T
                                a = remaining / 2;
                                t = remaining / 2;
                            }
                        }
                    }
                    
                    // 检查总和是否为100%
                    const total = a + t + g + c;
                    if (Math.abs(total - 100) > 0.1) {
                        valid = false;
                        message = `错误：碱基比例总和应为100%，当前为${total.toFixed(1)}%`;
                    }
                }
            } else {
                // 单链计算逻辑
                const a1 = parseFloat(document.getElementById('a1').value) || 0;
                const t1 = parseFloat(document.getElementById('t1').value) || 0;
                const g1 = parseFloat(document.getElementById('g1').value) || 0;
                const c1 = parseFloat(document.getElementById('c1').value) || 0;
                
                // 检查单链总和是否为100%
                const totalSingle = a1 + t1 + g1 + c1;
                if (Math.abs(totalSingle - 100) > 0.1) {
                    valid = false;
                    message = `错误：单链碱基比例总和应为100%，当前为${totalSingle.toFixed(1)}%`;
                } else {
                    // 计算互补链
                    const a2 = t1;
                    const t2 = a1;
                    const g2 = c1;
                    const c2 = g1;
                    
                    // 计算总比例
                    a = (a1 + a2) / 2;
                    t = (t1 + t2) / 2;
                    g = (g1 + g2) / 2;
                    c = (c1 + c2) / 2;
                    
                    // 显示互补链结果
                    document.getElementById('a2Result').textContent = `${a2.toFixed(1)}%`;
                    document.getElementById('t2Result').textContent = `${t2.toFixed(1)}%`;
                    document.getElementById('g2Result').textContent = `${g2.toFixed(1)}%`;
                    document.getElementById('c2Result').textContent = `${c2.toFixed(1)}%`;
                }
            }
            
            // 显示结果
            const resultDiv = document.getElementById('baseResult');
            const resultText = document.getElementById('baseResultText');
            
            if (valid) {
                // 更新图表
                updateBaseChart(a, t, g, c);
                
                // 显示结果
                resultText.textContent = `计算结果：A = ${a.toFixed(1)}%，T = ${t.toFixed(1)}%，G = ${g.toFixed(1)}%，C = ${c.toFixed(1)}%`;
                resultDiv.classList.remove('hidden');
            } else {
                resultText.textContent = message;
                resultDiv.classList.remove('hidden');
            }
        });
        
        // 重置碱基计算器
        function resetBases() {
            // 清空输入
            document.getElementById('adenine').value = '';
            document.getElementById('thymine').value = '';
            document.getElementById('guanine').value = '';
            document.getElementById('cytosine').value = '';
            document.getElementById('a1').value = '';
            document.getElementById('t1').value = '';
            document.getElementById('g1').value = '';
            document.getElementById('c1').value = '';
            
            // 清空结果
            document.getElementById('baseResult').classList.add('hidden');
            document.getElementById('a2Result').textContent = '-';
            document.getElementById('t2Result').textContent = '-';
            document.getElementById('g2Result').textContent = '-';
            document.getElementById('c2Result').textContent = '-';
            
            // 重置图表
            updateBaseChart(0, 0, 0, 0);
        }
        
        document.getElementById('resetBases').addEventListener('click', resetBases);
        
        // 清除DNA结构模型
        function clearDNAStructure() {
            const container = document.getElementById('basePairsContainer');
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
            
            // 清除磷酸基团和脱氧核糖
            document.querySelectorAll('.phosphate-group, .sugar-group').forEach(el => {
                el.remove();
            });
        }
        
        // 创建立体3D DNA结构模型
        function createDNAStructure(height, dnaType) {
            clearDNAStructure();
            const basePairsContainer = document.getElementById('basePairsContainer');
            const leftStrand = document.getElementById('leftStrand');
            const rightStrand = document.getElementById('rightStrand');
            
            // 确保高度至少为最小可见高度
            const maxHeight = 250; // 容器最大高度
            const minHeight = 20;  // 最小显示高度
            height = Math.max(minHeight, Math.min(height * 2, maxHeight)); // 增加高度比例使效果更明显
            
            // 设置链高度
            leftStrand.style.height = `${height}px`;
            rightStrand.style.height = `${height}px`;
            
            // 设置链的位置，确保居中显示
            const leftContainer = document.getElementById('leftStrandContainer');
            const rightContainer = document.getElementById('rightStrandContainer');
            leftContainer.style.top = `${(250 - height) / 2}px`;
            rightContainer.style.top = `${(250 - height) / 2}px`;
            basePairsContainer.style.top = `${(250 - height) / 2}px`;
            
            // 根据DNA类型确定参数
            let bpPerVisualUnit, colorScheme, helixAngle;
            switch(dnaType) {
                case 'A':
                    bpPerVisualUnit = 20;  // 每单位视觉高度显示的碱基对数量
                    colorScheme = '#FF6B6B'; // 红色系
                    helixAngle = 36;       // 每对碱基旋转角度
                    break;
                case 'B':
                    bpPerVisualUnit = 15;  // 每单位视觉高度显示的碱基对数量
                    colorScheme = '#4ECDC4'; // 蓝绿色系
                    helixAngle = 34;       // 每对碱基旋转角度
                    break;
                case 'Z':
                    bpPerVisualUnit = 25;  // 每单位视觉高度显示的碱基对数量
                    colorScheme = '#45B7D1'; // 蓝色系
                    helixAngle = 30;       // 每对碱基旋转角度
                    break;
            }
            
            // 计算需要显示的碱基对数量
            const displayBPs = Math.max(5, Math.round(height / 4)); // 每4px显示一个碱基对
            
            // 计算每个碱基对之间的垂直距离
            const verticalStep = height / displayBPs;
            
            // 创建立体的碱基对
            for (let i = 0; i < displayBPs; i++) {
                // 计算当前位置
                const yPos = i * verticalStep;
                
                // 计算螺旋角度，创造3D立体效果
                const angle = (i * helixAngle) % 360;
                const radians = angle * Math.PI / 180;
                
                // 创建立体碱基对容器
                const basePair = document.createElement('div');
                basePair.className = 'base-pair absolute transform-gpu transition-all duration-300 ease-in-out';
                basePair.style.width = '40px';
                basePair.style.height = '12px'; // 增加高度以显示立体效果
                basePair.style.top = `${yPos}px`;
                basePair.style.left = 'calc(50% - 20px)';
                
                // 应用3D旋转和位移效果
                basePair.style.transform = `rotateY(${angle}deg) translateZ(${Math.sin(radians * 2) * 5}px)`;
                basePair.style.transformOrigin = 'center center';
                
                // 设置渐变颜色，从底部到顶部变化，增强长度感
                const gradientPosition = i / displayBPs;
                const baseColor = hexToRgba(colorScheme, 0.8 + gradientPosition * 0.2);
                
                // 创建左侧碱基
                const leftBase = document.createElement('div');
                leftBase.className = 'absolute left-0 top-1/2 transform -translate-y-1/2';
                leftBase.style.width = '8px';
                leftBase.style.height = '10px';
                leftBase.style.backgroundColor = baseColor;
                leftBase.style.borderRadius = '2px';
                leftBase.style.boxShadow = '2px 0 3px rgba(0,0,0,0.2)';
                leftBase.style.backgroundImage = `linear-gradient(to right, ${baseColor}, ${hexToRgba(colorScheme, 0.5)})`;
                
                // 创建右侧碱基
                const rightBase = document.createElement('div');
                rightBase.className = 'absolute right-0 top-1/2 transform -translate-y-1/2';
                rightBase.style.width = '8px';
                rightBase.style.height = '10px';
                rightBase.style.backgroundColor = baseColor;
                rightBase.style.borderRadius = '2px';
                rightBase.style.boxShadow = '-2px 0 3px rgba(0,0,0,0.2)';
                rightBase.style.backgroundImage = `linear-gradient(to left, ${baseColor}, ${hexToRgba(colorScheme, 0.5)})`;
                
                // 创建连接两个碱基的立体横条
                const connector = document.createElement('div');
                connector.className = 'absolute left-8 right-8 top-1/2 transform -translate-y-1/2';
                connector.style.height = '6px';
                connector.style.backgroundColor = hexToRgba(colorScheme, 0.7);
                connector.style.borderRadius = '3px';
                connector.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';
                
                // 添加立体高光效果
                const highlight = document.createElement('div');
                highlight.className = 'absolute top-0 left-0 right-0 h-1';
                highlight.style.backgroundColor = 'rgba(255,255,255,0.6)';
                highlight.style.borderRadius = '1px 1px 0 0';
                connector.appendChild(highlight);
                
                // 添加氢键表示（简化为两条线）
                const bond1 = document.createElement('div');
                bond1.className = 'absolute top-1 left-1/4 w-0.5 h-4 bg-white/80';
                bond1.style.boxShadow = '0 0 2px rgba(255,255,255,0.8)';
                connector.appendChild(bond1);
                
                const bond2 = document.createElement('div');
                bond2.className = 'absolute top-1 right-1/4 w-0.5 h-4 bg-white/80';
                bond2.style.boxShadow = '0 0 2px rgba(255,255,255,0.8)';
                connector.appendChild(bond2);
                
                // 组装碱基对
                basePair.appendChild(leftBase);
                basePair.appendChild(connector);
                basePair.appendChild(rightBase);
                
                // 添加微小的延迟，创造动画效果
                setTimeout(() => {
                    basePairsContainer.appendChild(basePair);
                    // 添加出现动画
                    basePair.style.opacity = '0';
                    setTimeout(() => {
                        basePair.style.opacity = '1';
                    }, 10);
                }, i * 10);
            }
            
            // 添加长度标记（在模型右侧）
            const scaleDiv = document.querySelector('.length-scale');
            scaleDiv.innerHTML = '';
            
            // 根据高度添加5个主要刻度
            const numMarks = 5;
            for (let i = 0; i <= numMarks; i++) {
                const mark = document.createElement('div');
                mark.className = 'flex items-center';
                
                const line = document.createElement('div');
                line.className = 'h-0.5 w-3 bg-gray-600';
                line.style.boxShadow = '1px 1px 2px rgba(0,0,0,0.2)';
                
                const label = document.createElement('div');
                const positionValue = Math.round((i / numMarks) * height / 2); // 转换回原始高度值
                label.className = 'ml-1 text-xs font-medium text-gray-700 whitespace-nowrap';
                label.textContent = `${positionValue}nm`;
                
                mark.appendChild(line);
                mark.appendChild(label);
                mark.style.position = 'absolute';
                mark.style.right = '0';
                mark.style.top = `${(i / numMarks) * height + (250 - height) / 2}px`;
                mark.style.zIndex = '10';
                
                scaleDiv.appendChild(mark);
            }
        }
        
        // 将十六进制颜色转换为RGBA
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        
        // DNA长度计算与高精度模型可视化 - 优化版本
        document.getElementById('calculateLength').addEventListener('click', function() {
            const basePairs = parseInt(document.getElementById('basePairs').value);
            const dnaType = document.getElementById('dnaType').value;
            const maxVisualHeight = 200; // 可视化的最大高度（像素）
            const maxLength = 10000; // 对应最大高度的实际长度（nm）
            
            let lengthPerBP, dnaTypeName;
            let resultText = '';
            
            // 根据DNA类型设置每个碱基对的长度
            switch(dnaType) {
                case 'A':
                    lengthPerBP = 0.26; // nm
                    dnaTypeName = 'A-DNA';
                    break;
                case 'B':
                    lengthPerBP = 0.34; // nm
                    dnaTypeName = 'B-DNA';
                    break;
                case 'Z':
                    lengthPerBP = 0.37; // nm
                    dnaTypeName = 'Z-DNA';
                    break;
            }
            
            if (isNaN(basePairs) || basePairs <= 0) {
                resultText = '请输入有效的碱基对数量（正整数）';
                // 即使输入无效，也显示默认模型
                const defaultVisualHeight = 34; // 500 bp × 0.34 nm × (200 px / 10000 nm)
                createDNAStructure(defaultVisualHeight, 'B');
                document.getElementById('visualizationLabel').textContent = '170.00 nm (500 bp)';
            } else {
                // 计算长度（纳米）
                const lengthNM = basePairs * lengthPerBP;
                
                // 转换为其他单位
                const lengthUM = lengthNM / 1000; // 微米
                const lengthMM = lengthUM / 1000; // 毫米
                const lengthM = lengthMM / 1000;  // 米
                
                // 构建结果文本
                resultText = `${dnaTypeName}的长度计算结果：<br>`;
                resultText += `${lengthNM.toFixed(2)} 纳米 (nm)<br>`;
                if (lengthUM >= 0.01) {
                    resultText += `${lengthUM.toFixed(6)} 微米 (μm)<br>`;
                }
                if (lengthMM >= 0.00001) {
                    resultText += `${lengthMM.toFixed(9)} 毫米 (mm)<br>`;
                }
                if (lengthM >= 0.00000001) {
                    resultText += `${lengthM.toFixed(12)} 米 (m)`;
                }
                
                // 更新可视化高度（限制最大高度）
                let visualHeight = (lengthNM / maxLength) * maxVisualHeight;
                if (visualHeight > maxVisualHeight) visualHeight = maxVisualHeight;
                
                // 平滑过渡到新的模型
                const dnaModelContainer = document.querySelector('.helix-inner');
                dnaModelContainer.style.opacity = '0.6';
                
                setTimeout(() => {
                    // 创建高精度DNA结构模型
                    createDNAStructure(visualHeight, dnaType);
                    
                    // 更新标签
                    document.getElementById('visualizationLabel').textContent = 
                        `${lengthNM.toFixed(2)} nm (${basePairs} bp)`;
                    document.getElementById('maxLengthLabel').textContent = `${maxLength} nm`;
                    
                    // 恢复不透明度
                    dnaModelContainer.style.opacity = '1';
                }, 300);
            }
            
            // 显示结果
            document.getElementById('lengthResultText').innerHTML = resultText;
            document.getElementById('lengthResult').classList.remove('hidden');
        });
        
        // 重置DNA长度计算器
        document.getElementById('resetLength').addEventListener('click', function() {
            document.getElementById('basePairs').value = '';
            document.getElementById('dnaType').value = 'B';
            document.getElementById('lengthResult').classList.add('hidden');
            
            // 重置可视化模型
            document.getElementById('leftStrand').style.height = '0px';
            document.getElementById('rightStrand').style.height = '0px';
            clearDNAStructure();
            document.getElementById('visualizationLabel').textContent = '请输入碱基对数量进行计算';
        });
        
        // 练习题答案显示/隐藏
        document.querySelectorAll('.showAnswer').forEach(button => {
            button.addEventListener('click', function() {
                const answerElement = this.nextElementSibling;
                const answerText = this.getAttribute('data-answer');
                
                if (answerElement.classList.contains('hidden')) {
                    answerElement.textContent = answerText;
                    answerElement.classList.remove('hidden');
                    this.textContent = '隐藏答案';
                } else {
                    answerElement.classList.add('hidden');
                    this.textContent = '显示答案';
                }
            });
        });
        
        // 页面加载完成后初始化图表和默认DNA模型
        window.addEventListener('load', function() {
            // 确保Chart.js已加载
            if (typeof Chart !== 'undefined') {
                initBaseChart();
            } else {
                console.log('Chart.js 尚未加载，稍后重试...');
                setTimeout(initBaseChart, 500);
            }
            
            // 页面加载时显示默认的DNA模型（500 bp B-DNA）
            setTimeout(() => {
                const defaultVisualHeight = 34; // 500 bp × 0.34 nm × (200 px / 10000 nm)
                createDNAStructure(defaultVisualHeight, 'B');
                
                // 设置默认标签
                document.getElementById('visualizationLabel').textContent = '170.00 nm (500 bp)';
            }, 100);
        });
        
        // 确保Chart.js已加载的备用方法
        function ensureChartJsLoaded() {
            if (typeof Chart !== 'undefined') {
                return true;
            }
            console.warn('Chart.js 未定义，尝试重新初始化...');
            return false;
        }
        
        // 修改initBaseChart函数，添加错误处理
        function initBaseChart() {
            if (!ensureChartJsLoaded()) {
                setTimeout(initBaseChart, 500);
                return;
            }
            
            const ctx = document.getElementById('baseChart').getContext('2d');
            try {
                baseChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['腺嘌呤 (A)', '胸腺嘧啶 (T)', '鸟嘌呤 (G)', '胞嘧啶 (C)'],
                        datasets: [{
                            data: [0, 0, 0, 0],
                            backgroundColor: [
                                '#FF4757', // 红色 - A
                                '#FF9F43', // 橙色 - T
                                '#2ED573', // 绿色 - G
                                '#5352ED'  // 蓝色 - C
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        size: 11
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('初始化图表时出错:', error);
            }
        }
    </script>
</body>
</html>